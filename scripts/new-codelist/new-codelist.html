<html>
    <head>
        <p>CREATE CONSTRAINT ON (n:`_code`) ASSERT n.code IS UNIQUE;</p>
        <script src = "https://cdn.ons.gov.uk/vendor/d3/4.13.0/d3.min.js" ></script>
    </head>
    <body>
        <div id = "cypher"></div>
    </body>

<script>
    let root = "codelist.csv"

    document.addEventListener("DOMContentLoaded", function () {
        // fetch(root, {
        //         mode: 'cors'
        //     })
        //     .then(data => data.json())
        //     .then(function (data) {
        //         console.log(data)
        //         codelist = data["0"].links.code_list.id
        //         data.map(function (data) {
        //             writeCypher (data)
        //             })
        //     })
        d3.csv(root, function(data) {
            headerRow = Object.keys(data[0])
            codelist = headerRow["0"]
            label = headerRow["1"]
            let node = document.createElement("p");                 // Create a <h1> node
            let textnode = document.createTextNode("CREATE (node:`_code_list`:`_name_"+codelist+"` { label:'"+ label+ "', edition:'one-off' });");     // Create a text node
            node.appendChild(textnode);                              // Append the text to <h1>
            document.getElementById("cypher").appendChild(node);


            data.map(function (data) {
                    writeCypher (data)
                    })
        });
        })

    function writeCypher (data){
        let node = document.createElement("p");                 // Create a <h1> node
        let textnode = document.createTextNode("MATCH (parent:`_code_list`:`_name_" + codelist + "`) WITH parent CREATE (node:`_code` { value:'" + data[codelist] + "' })-[:usedBy { label:\""+ data[label] + "\"}]->(parent);");     // Create a text node
        node.appendChild(textnode);                              // Append the text to <h1>
        document.getElementById("cypher").appendChild(node);
    }
</script>

</html>